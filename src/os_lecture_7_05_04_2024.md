# 05.04.2024

# ОС/Лекция 7

# Управление памятью (продолжение)

Концепция виртуальной памяти в том, что каждому процессу выделяется своё независимое виртуальное адресное пространство. Виртуальное адресное пространство делится на виртуальные страницы. Физическая память делится на страничные блоки (или просто блоки). Для организации соотвествия между виртуальными страницами и страничными блоками используется таблица страниц.

## Инвертированные таблицы страниц

Что если не по виртуальному адресу определять физический, а пойдём от обратного? В инвертированной таблице страниц хранится информация о том, что... ничо не понял. тут нужно почить и разобраться.

Многоуровневые таблицы страниц более распространённые чем инвертированные.

Операционная система должна уметь обрабатывать специальный вид ошибок: ошибка доступа к виртуальной странице. 

## Алгоритм замещения страниц

Если физической памяти не хвататет, то запускается <u>алгоритм замещения страниц</u>. Алгоритм замещения страниц решает, какую страницу лучше выгрузить на жёсткий диск, чтобы освободить память и обеспечить наилучшее быстродействие.

### Оптимальный алгоритм замещения страниц

Данный алгоритм предполагает, что для каждой страницы будет известно колчество команд, которые должны быть выполнены до следующего обращения к странице. Будет выгружена страница, обращение к которой происзойдёт позже всего.

**НО** подсчёт количества команд до следующего обращения к памяти не реализуем.

### Алгоритм "Исключение не использовавшейся недавно страницы"

Англ. : NRU, Not Recently Used

Реализация данного алгоритма требует добавить два дополнительных столбца (которые будут хранить единичные биты каждая) в таблицу страниц:
- бит R: устанавливается при каждом обращении к странице (чтение или запись);
- бит M: устанавливается при записи на страницу.

Бит M устанавливается в единицу только если происходит обращение на записать. Бит R показывает были ли недавно обращения к странице недавно. Бит R сбрасывается по прерыванию таймера.

Исходя из данных битов, можно разбить страницы на классы:
- Класс 0: в последнее время не было ни обращений, ни модификаций; (<- наилучший кандидат, чтобы убрать его из памяти)
- Класс 1: обращений в последнее время не было, но страница модицирована;
- Класс 2: в последнее время были обращения, но мидификаций не было;
- Класс 3: в последнее время были и обращения, и модификации.

### Алгоритм "Первой пришла, первой ушла"

Англ. : FIFO, first in first out

Помимо таблицы страниц есть очередь. ОС ведёт список страниц, находящихся в памяти.

Новые загружаемые страницы помещаются в конец очереди.

### Алгоритм "второй шанс"

Очередь можно улучшить, если мы добавим бит R.

[Иллюстрация к алгоритму "второй шанс"](../assets/suai_os_secon_chanse_algo.jpg)

### Алгоритм "Часы"

Улучшение подхода алгоритма "второй шанс". Когда происходит страничное прерывание, проверяется страницы, на которую указывает стрелка. Предпринмаемые действия заисят от бита R:
		если R == 0, то страница выгржуется,
		если R == 1, бит R сбрасывается, стрелка движется вперёд.

Алгоритм "Часы":
[Иллюстрация к алгоритму "Часы"](../assets/suai_os_clock_algo.png)

### Алгоритм замещения наименее востребованной страницы

Англ. : LRU, least recently used.

Алгоритм "старения":
[Иллюстрация к алгоритму "LRU"](../assets/suai_os_lru_algo.png)

### Алгоритм "Рабочий набор"

Идея алгоритма заключается в том, что программы в разные этапы своей работы используют разные наборы (множества) адресов памяти. "тау" - время, ограничивающее "рабочий набор".

## Алгоритм WSClock

Данный алгоритм является модификацией алгоритма "Рабочий набор". Здесь вместо линейного списка используется циклический список (как в алгоритме "Часы").

[Сравнение алгоритмов замещения страниц](../assets/suai_os_virtual_pages_algo_comparison.png)

