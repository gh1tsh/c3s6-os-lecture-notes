# 03.05.2024

# ОС/Лекция 10

# Взаимоблокировка (deadlock, тупик)

Это ситуация, при которой два или более потока (процесса) взаимно заблокированны (т.е.е не могу продолжать выполнение). 

Примером из жизни такой ситуации может выступить равнозначный перекрёсток и машины, находящиеся на каждой из его дорог. Каждый автомобиль должен будет пропустить помеху справа и одновременно сможет ехать. В итоге ни одна машина не поедет

Взаимоблокировка невозможна без наличия ресурса (какого бы то ни было).

Ресурс в данном случае это объект, к которому предоставляется доступ. Ресурсы могут быть программными и аппаратными. Выгружаемые ресурсы могут быть отобраны у процесса без проблем. Невыгружаемые ресурс нельзя отобрть, не вызвав сбоя в вычислениях.

Вывод: соместная рабоат с ресрусами - основная причина возникновения взаимоблокировок.

Условия возникновения взаимной блокировки:
- взаимное исключение: ресурс либо занят, либо свободен;
- удержание и ожидание: процесс, удреживающий один ресурс, может запросить дополнительные ресурсы;
- невыгружаемость: отбирать ресрусы у процесса нельзя;
- циклическое ожидание: существует кольцевая последовательность из 2-ч или более процессов, ожидающих освобождения ресурса, захваченного другим процессом.

Для возникновения взаимной блокировки **необходимо** выполнение всех четырёх условий.

## Стратегии борьбы с взаимными блокировками

Существует четыре основные стратегии:
- "Страусиный алгоритм" ("прячем голову в песок" == игнорируем deadlock, не предпринимаем никаких шагов для его устранения);
- обнаружение взаимных блокировок и восстановление работоспособности;

Один из способов является построение спец. графа, на котором отображаются отношения между ресурсами и потоками. Если в графе появляется цикл, это означает, что возникла взаимная блокировка. Также можно использовать не граф, а матрицу.

Первое, что нужно сделать для того, чтобы восстановить работоспособность, нужно ввести приоритеты. Какой процесс приоритетней, тот и продолжит работу. Другой подход состоит в том, что создаются так называемые точки восстановления. Будем с определённой периодичностью сохранять состояние процессов и потоков. При возникновении взаимной блокировки, будем "откатывать" состояние на ближайшее исправное. При таком подходе будут потери вычисление, которые были произведены между состоянием блокировки и исправным состоянием. Третий способ решить проблему - уничтожение одного из процессов.

Полностью разрешить ситуацию со взаимоблокировкой невозможно без негатиных эффектов.

- уклонение от взаимных блокировок;

Ещё один способ не допустить ситуацию взаимной блокировки - это максимально от них уклоняться. При выполнении процессов и потоков можно также отслеживать (например, с помощью графа) ситуации, которые ведут к циклам в нашем графе. Т.е. если произойдёт "что-то", то возникнет взаимная блокировка. При выявлении таких признаков, нужно дать сигнал планировщику задач, чтобы он предпринял определённые шаги по защите.

- предоствращение возникновения взаимных блокировок.

Нужно запретить ОС делать некоторые вещи (причины перечисленные выше).

# Гипервизоры

На современном этапе развития технологий мы пришли к тому, что операционная система и гипервизор это практически одно и то же (слились воедино).

Существует два типа гипервизоров: Bare Metal и Hosted. Hosted это, например, Virtual Box, VM Ware (работает поверх ОС). Bare Matel работает сразу на железе (в основном на серверах).

# Кодировки

ASCII (7 bit) самая распространённая.

Кириллица:
- CP-866 (MS-DOS);
- Windows 1251;
- Mac OS Cyrillic;
- KOI8-R: Kod Obmena Informatsiey, 8 bit.

Unicode (стандарт):
- UTF-16: UTF-16LE (Windows), UTF-16BE (rfc 2781);
- UTF-32;
- UTF-8.

Подход UTF-8 заключается в том, что один символ может быть закодирован с помощью одного, двух, трёх, четырёх и т.д. байт.

В первом байте первые 7 бит информационные (стандартный английский язык ascii). Последний бит сигнализирует длину символа. Если 0, то для представления символа используется 1 байт. Если один, то читаем следующий. В нём информативными будут 6 байт, а два уйдут на то, чтобы сигнализировать есть ли ещё один байт в предсталении символа.

# Время

- Всемирное координированное время UTC
- Зимнее/летнее время;
- Дополнительная секунда (leap second);

ИСПОЛЬЗУЙТЕ ГОТОВЫЕ БИБЛИОТЕКИ ДЛЯ РАБОТЫ С ДАТОЙ И ВРЕМЕНЕМ!

# Обратная совместимость (legacy)

- В Windows 10 нельзя создать файлы с такими именами: con, aux, prn, lst, com0, ... , com9, lpt0, ... , lpt9, nul, так как в MS-DOS эти имена были зарезервированы для файлов соответсвующих устройств.
- API. В Виндовс есть функции с постфиксом ...Ex (extended). Были функции для которых с ходом времени требовался новый функционал. Майкрософт просто создавали новые, расширенные функции.
- ПО. MS Excel: был редактов Lotus, который в последствии купит майкрософт и превратит в MS Excel. В этом редакторе можно было задать несуществующую дату 29 февраля 1900. Этот баг оставили специально в MS Excel (во всех версиях, включая современную) для сохранения обратной соместитмости.
